<!doctype html><html lang=en dir=ltr><head><meta name=generator content="Hugo 0.106.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Conditional expressions # Although Oracle as support for the different conditional expressions as specified by the SQL standard, far too many SQL queries still use Oracle&rsquo;s historical functions.
DECODE # Oracle&rsquo;s DECODE function is a proprietary equivalent of the standard compliant CASE clause."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Conditional expressions"><meta property="og:description" content="Conditional expressions # Although Oracle as support for the different conditional expressions as specified by the SQL standard, far too many SQL queries still use Oracle&rsquo;s historical functions.
DECODE # Oracle&rsquo;s DECODE function is a proprietary equivalent of the standard compliant CASE clause."><meta property="og:type" content="article"><meta property="og:url" content="https://example.com/conditional-expressions/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-11-21T17:42:55+01:00"><meta property="og:site_name" content="From Oracle to PostgreSQL"><title>Conditional expressions</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=alternate hreflang=fr href=https://example.com/fr/expressions-conditionnelles/ title="Expressions conditionnelles"><link rel=stylesheet href=/book.min.a0b1bf814d7fc28217ec0eea7c47371480fb4f325cec9eb1ae1aa1097d715ec7.css integrity="sha256-oLG/gU1/woIX7A7qfEc3FID7TzJc7J6xrhqhCX1xXsc="><script defer src=/en.search.min.95c92b6d1acfeccbfbe5b5bcabbf661d49ac6c98314c68e7361dc54efea924c2.js integrity="sha256-lckrbRrP7Mv75bW8q79mHUmsbJgxTGjnNh3FTv6pJMI="></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/><img src=/images/logo.png alt=Logo><span>From Oracle to PostgreSQL</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://example.com/general-differences-between-oracle-and-postgresql/>General differences</a><ul></ul></li><li><input type=checkbox id=section-88c4d5ca464ed2de3d87c4f315803bbb class=toggle>
<label for=section-88c4d5ca464ed2de3d87c4f315803bbb class="flex justify-between"><a href=https://example.com/porting-the-database-schema-to-postgresql/>Porting database objects</a></label><ul><li><a href=https://example.com/datatypes/>Datatypes</a></li><li><a href=https://example.com/table-migration/>Table migration</a></li><li><a href=https://example.com/views-migration/>Views migration</a></li><li><a href=https://example.com/sequences-migration/>Sequences migration</a></li><li><a href=https://example.com/index-migration/>Index migration</a></li><li><a href=https://example.com/partitioning/>Partitioning</a></li></ul></li><li><input type=checkbox id=section-b7e37e1862e6db598e5e41747363d74a class=toggle checked>
<label for=section-b7e37e1862e6db598e5e41747363d74a class="flex justify-between"><a href=https://example.com/porting-sql-queries/>Porting SQL queries</a></label><ul><li><a href=https://example.com/specificities-on-data-types/>Specificities on Data types</a></li><li><a href=https://example.com/joins/>Joins</a></li><li><a href=https://example.com/conditional-expressions/ class=active>Conditional expressions</a></li><li><a href=https://example.com/hierarchical-querying/>Hierarchical querying</a></li><li><a href=https://example.com/transaction-management/>Transaction management</a></li></ul></li><li><input type=checkbox id=section-cfaa4d420be7e860c2f111a313f9a252 class=toggle>
<label for=section-cfaa4d420be7e860c2f111a313f9a252 class="flex justify-between"><a href=https://example.com/pl-sql-to-pl-pgsql-porting/>PL/SQL to PL/pgSQL porting</a></label><ul><li><a href=https://example.com/porting-procedures-and-functions/>Porting procedures and functions</a></li><li><a href=https://example.com/triggers-conversion/>Triggers conversion</a></li><li><a href=https://example.com/control-structures/>Control structures</a></li><li><a href=https://example.com/pl-sql-code-conversion/>PL/SQL code conversion</a></li><li><a href=https://example.com/cursors/>Cursors</a></li><li><a href=https://example.com/pl-sql-specificities/>PL/SQL specificities</a></li><li><a href=https://example.com/oracles-packages/>Oracle's packages</a></li></ul></li><li><a href=https://example.com/contact-us/>Contact us</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Conditional expressions</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#conditional-expressions>Conditional expressions</a><ul><li><a href=#decode>DECODE</a></li><li><a href=#nvl>NVL</a></li><li><a href=#rownum>ROWNUM</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=conditional-expressions>Conditional expressions
<a class=anchor href=#conditional-expressions>#</a></h2><p>Although Oracle as support for the different conditional expressions as
specified by the SQL standard, far too many SQL queries still use Oracle&rsquo;s
historical functions.</p><h3 id=decode>DECODE
<a class=anchor href=#decode>#</a></h3><p>Oracle&rsquo;s <code>DECODE</code> function is a proprietary equivalent of the standard compliant
<code>CASE</code> clause.</p><p>Here is an example of <code>DECODE</code> use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> emp_name,
</span></span><span style=display:flex><span>       decode(
</span></span><span style=display:flex><span>          trunc((yrs_of_service <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>),
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>04</span>,
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>04</span>,
</span></span><span style=display:flex><span>          <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>06</span>
</span></span><span style=display:flex><span>       ) <span style=color:#66d9ef>AS</span> perc_value
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> employees;
</span></span></code></pre></div><p>This should be rewritten this way:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> emp_name,
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> trunc(yrs_of_service <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>THEN</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>04</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>WHEN</span> trunc(yrs_of_service <span style=color:#f92672>+</span> <span style=color:#ae81ff>3</span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>THEN</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>04</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>ELSE</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>06</span>
</span></span><span style=display:flex><span>       <span style=color:#66d9ef>END</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> employees;
</span></span></code></pre></div><p>Here is another example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>DECODE(<span style=color:#e6db74>&#39;user_status&#39;</span>,<span style=color:#e6db74>&#39;active&#39;</span>,<span style=color:#e6db74>&#39;username&#39;</span>,<span style=color:#66d9ef>NULL</span>)
</span></span></code></pre></div><p>This should be rewritten as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> user_status<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;active&#39;</span> <span style=color:#66d9ef>THEN</span> username <span style=color:#66d9ef>ELSE</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>END</span>
</span></span></code></pre></div><p>Pay attention to the comments between <code>WHEN</code> and <code>THEN</code>, that are not supported
by PostgreSQL.</p><p>References:</p><ul><li><a href=https://www.postgresql.org/docs/current/functions-conditional.html#FUNCTIONS-CASE>CASE</a></li></ul><h3 id=nvl>NVL
<a class=anchor href=#nvl>#</a></h3><p>Oracle&rsquo;s <code>NVL</code> function is still often used, although the standard-compliant
<code>COALESCE</code> is also available. These two functions return the first non-NULL
argument of a list. Of course, PostgreSQL only implements the standard compliant
function, <code>COALESCE</code>. Replacing NVL with <code>COALESCE</code> should be sufficient.</p><p>Thus, the following query:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> NVL(description, short_description, <span style=color:#e6db74>&#39;(none)&#39;</span>) <span style=color:#66d9ef>FROM</span> articles;
</span></span></code></pre></div><p>will be easily converted to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> COALESCE(description, short_description, <span style=color:#e6db74>&#39;(none)&#39;</span>) <span style=color:#66d9ef>FROM</span> articles;
</span></span></code></pre></div><p>References:</p><ul><li><a href=https://www.postgresql.org/docs/current/functions-conditional.html#FUNCTIONS-COALESCE-NVL-IFNULL>COALESCE</a></li></ul><h3 id=rownum>ROWNUM
<a class=anchor href=#rownum>#</a></h3><p>Oracle presents a <code>ROWNUM</code> pseudo-column which can be used to number a query&rsquo;s
result lines. The <code>ROWNUM</code> can be used to number the lines, or to limit the number
of lines returned by a query.</p><h4 id=rownum-for-numbering>ROWNUM for numbering
<a class=anchor href=#rownum-for-numbering>#</a></h4><p>In the first case, numbering the lines of a result set, the query should be
rewritten to make use of the <code>row_number()</code> window function. Though Oracle
recommends using the standard compliant <code>row_number()</code> function, <code>ROWNUM</code> is still
frequently used in a query:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> ROWNUM, <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> employees;
</span></span></code></pre></div><p>This will be rewritten as:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> row_number() OVER () <span style=color:#66d9ef>AS</span> rownum, <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> employees;
</span></span></code></pre></div><p>One should pay attention to a query using <code>ORDER BY</code> and <code>ROWNUM</code> to number the
lines returned by a query. Indeed, the sort is performed after the rownum
assignment. These queries should be double-checked.</p><h4 id=rownum-and-limiting-results>ROWNUM and limiting results
<a class=anchor href=#rownum-and-limiting-results>#</a></h4><p>To limit the set returned by a query, the ROWNUM predicates should be replaced
by <code>LIMIT/OFFSET</code>.</p><p>The following query returns the first 10 lines of the <code>employees</code> table in
Oracle:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> employees
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> ROWNUM <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>11</span>;
</span></span></code></pre></div><p>It will be rewritten as this in PostgreSQL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> employees
</span></span><span style=display:flex><span> <span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>10</span>;
</span></span></code></pre></div><p>If the result need to be sorted in a particular way, Oracle will operate a
sorting node with <code>ORDER BY</code> after adding the <code>ROWNUM</code> pseudo-column (<code>COUNT STOPKEY</code>), as shown in the execution plan of the previous query:</p><pre tabindex=0><code>---------------------------------------------------------------------------------
| Id  | Operation            | Name      | Rows | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------
|   0 | SELECT STATEMENT     |           |   10 |   690 |     3  (34)| 00:00:01 |
|   1 |  SORT ORDER BY       |           |   10 |   690 |     3  (34)| 00:00:01 |
|*  2 |   COUNT STOPKEY      |           |      |       |            |          |
|   3 |    TABLE ACCESS FULL | EMPLOYEES |   10 |   690 |     2   (0)| 00:00:01 |
---------------------------------------------------------------------------------
</code></pre><p>A query limiting with Oracle is generally written this way (to work around the
fact that <code>ROWNUM</code> is performed before the sorting):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> ROWNUM, r.<span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> (<span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>FROM</span> t1
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> col) r
</span></span><span style=display:flex><span> <span style=color:#66d9ef>WHERE</span> ROWNUM <span style=color:#66d9ef>BETWEEN</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>AND</span> <span style=color:#ae81ff>10</span>;
</span></span></code></pre></div><p>On the opposite, PostgreSQL will first sort, then limit the result. When
PostgreSQL has both a <code>LIMIT</code> and a sort with <code>ORDER BY</code>, the sort will be
performed first. This should be written this way in PostgreSQL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>FROM</span> employees
</span></span><span style=display:flex><span> <span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> salary <span style=color:#66d9ef>DESC</span> 
</span></span><span style=display:flex><span> <span style=color:#66d9ef>LIMIT</span> <span style=color:#ae81ff>10</span>;
</span></span></code></pre></div><pre tabindex=0><code>                               QUERY PLAN                                
-------------------------------------------------------------------
 Limit (cost=81.44..81.46 rows=10 width=8)
   -&gt; Sort (cost=81.44..87.09 rows=2260 width=8)
      Sort Key: salary DESC
      -&gt; Seq Scan on employees (cost=0.00..32.60 rows=2260 width=8)
</code></pre><p>References:</p><ul><li><a href=https://www.postgresql.org/docs/current/queries-limit.html>LIMIT and OFFSET</a></li><li><a href=https://www.postgresql.org/docs/current/functions-window.html>Window Functions</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</li></ul><ul class=book-languages-list><li><a href=https://example.com/fr/expressions-conditionnelles/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
French</a></li></ul></div><div><a class="flex align-center" href=https://github.com/dalibo/from-oracle-to-postgresql/commit/0e0e39630a9315928b94eb8adbab6b0771fc83ec title='Last modified by Florent Jardin | November 21, 2022' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 21, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/dalibo/from-oracle-to-postgresql/edit/main/content.en/docs/sql/conditions.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#conditional-expressions>Conditional expressions</a><ul><li><a href=#decode>DECODE</a></li><li><a href=#nvl>NVL</a></li><li><a href=#rownum>ROWNUM</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>