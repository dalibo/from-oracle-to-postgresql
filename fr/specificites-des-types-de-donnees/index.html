<!doctype html><html lang=fr dir=ltr><head><meta name=generator content="Hugo 0.106.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Spécificités des types de données # Manipulation des types VARCHAR # Pour Oracle, une chaine vide est aussi une chaîne NULL. Elle a les deux propriétés à la fois. PostgreSQL fait la différence : soit la chaîne est inconnue (IS NULL) soit elle est vide."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Spécificités des types de données"><meta property="og:description" content="Spécificités des types de données # Manipulation des types VARCHAR # Pour Oracle, une chaine vide est aussi une chaîne NULL. Elle a les deux propriétés à la fois. PostgreSQL fait la différence : soit la chaîne est inconnue (IS NULL) soit elle est vide."><meta property="og:type" content="article"><meta property="og:url" content="https://example.com/fr/specificites-des-types-de-donnees/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-11-21T17:42:55+01:00"><meta property="og:site_name" content="Porter Oracle vers PostgreSQL"><title>Spécificités des types de données</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=alternate hreflang=en href=https://example.com/specificities-on-data-types/ title="Specificities on Data types"><link rel=stylesheet href=/book.min.a0b1bf814d7fc28217ec0eea7c47371480fb4f325cec9eb1ae1aa1097d715ec7.css integrity="sha256-oLG/gU1/woIX7A7qfEc3FID7TzJc7J6xrhqhCX1xXsc="><script defer src=/fr.search.min.5d63b8891e1dc2263e2b13f848788122e3355a2ceb861e5d51f75a06ead1be44.js integrity="sha256-XWO4iR4dwiY+KxP4SHiBIuM1Wizrhh5dUfdaBurRvkQ="></script>
<script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk="></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/fr><img src=/images/logo.png alt=Logo><span>Porter Oracle vers PostgreSQL</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Rechercher aria-label=Rechercher maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://example.com/fr/differences-generales-entre-oracle-et-postgresql/>Différences générales</a><ul></ul></li><li><input type=checkbox id=section-88c4d5ca464ed2de3d87c4f315803bbb class=toggle>
<label for=section-88c4d5ca464ed2de3d87c4f315803bbb class="flex justify-between"><a href=https://example.com/fr/portage-du-schema-de-la-base-de-donnees/>Portage du schéma</a></label><ul><li><a href=https://example.com/fr/correspondance-des-types-de-donnees/>Correspondance des types de données</a></li><li><a href=https://example.com/fr/reprise-des-tables/>Reprise des tables</a></li><li><a href=https://example.com/fr/reprise-des-vues/>Reprise des vues</a></li><li><a href=https://example.com/fr/reprise-des-sequences/>Reprise des séquences</a></li><li><a href=https://example.com/fr/reprise-des-index/>Reprise des index</a></li><li><a href=https://example.com/fr/reprise-des-partitions/>Reprise des partitions</a></li></ul></li><li><input type=checkbox id=section-b7e37e1862e6db598e5e41747363d74a class=toggle checked>
<label for=section-b7e37e1862e6db598e5e41747363d74a class="flex justify-between"><a href=https://example.com/fr/portage-des-requetes-sql/>Portage des requêtes SQL</a></label><ul><li><a href=https://example.com/fr/specificites-des-types-de-donnees/ class=active>Spécificités des types de données</a></li><li><a href=https://example.com/fr/jointures/>Jointures</a></li><li><a href=https://example.com/fr/expressions-conditionnelles/>Expressions conditionnelles</a></li><li><a href=https://example.com/fr/traitement-des-hierarchies/>Traitement des hiérarchies</a></li><li><a href=https://example.com/fr/gestion-des-transactions/>Gestion des transactions</a></li></ul></li><li><input type=checkbox id=section-cfaa4d420be7e860c2f111a313f9a252 class=toggle>
<label for=section-cfaa4d420be7e860c2f111a313f9a252 class="flex justify-between"><a href=https://example.com/fr/portage-du-code-pl-sql-vers-pl-pgsql/>Portage du code PL/SQL vers PL/pgSQL</a></label><ul><li><a href=https://example.com/fr/portage-des-procedures-et-fonctions/>Portage des procédures et fonctions</a></li><li><a href=https://example.com/fr/portage-des-triggers/>Portage des triggers</a></li><li><a href=https://example.com/fr/structures-de-controles/>Structures de contrôles</a></li><li><a href=https://example.com/fr/reprise-du-code-pl-sql/>Reprise du code PL/SQL</a></li><li><a href=https://example.com/fr/curseurs/>Curseurs</a></li><li><a href=https://example.com/fr/specificites-pl-sql/>Spécificités PL/SQL</a></li><li><a href=https://example.com/fr/packages-proprietaires/>Packages propriétaires</a></li></ul></li><li><a href=https://example.com/fr/nous-contacter/>Nous contacter</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Spécificités des types de données</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><ul><li><a href=#spécificités-des-types-de-données>Spécificités des types de données</a><ul><li><a href=#manipulation-des-types-varchar>Manipulation des types VARCHAR</a></li><li><a href=#manipulation-de-dates>Manipulation de dates</a></li></ul></li></ul></li></ul></nav></aside></header><article class=markdown><h2 id=spécificités-des-types-de-données>Spécificités des types de données
<a class=anchor href=#sp%c3%a9cificit%c3%a9s-des-types-de-donn%c3%a9es>#</a></h2><h3 id=manipulation-des-types-varchar>Manipulation des types VARCHAR
<a class=anchor href=#manipulation-des-types-varchar>#</a></h3><p>Pour Oracle, une chaine vide est aussi une chaîne <code>NULL</code>. Elle a les deux
propriétés à la fois. PostgreSQL fait la différence : soit la chaîne est inconnue
(<code>IS NULL</code>) soit elle est vide.</p><p>Certaines requêtes donnant satisfaction sous Oracle peuvent donner des résultats
faux lorsqu&rsquo;elles sont portées directement. Les cas les plus courants sont la
comparaison de la valeur d&rsquo;une colonne avec une chaîne vide et la concaténation
avec une valeur <code>NULL</code>.</p><h4 id=comparaison>Comparaison
<a class=anchor href=#comparaison>#</a></h4><p>Pour Oracle, si la colonne <code>col</code> est un <code>VARCHAR2</code>, les deux requêtes
suivantes vont retourner le même résultat :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>WHERE</span> col <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> <span style=color:#66d9ef>TABLE</span> <span style=color:#66d9ef>WHERE</span> col <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>;
</span></span></code></pre></div><p>Mais sous PostgreSQL, les deux requêtes ne retourneront pas le même résultat.
Ora2Pg transpose les valeurs <code>NULL</code> des colonnes en <code>VARCHAR2</code> en valeur
<code>NULL</code> pour un type <code>VARCHAR</code>. La première requête ne retournera aucun
résultat.</p><p>Il est donc nécessaire de réécrire la requête concernée en utilisant les opérateurs
<code>IS NULL</code> ou <code>IS NOT NULL</code>. Dans ce cas, la requête pourra utiliser un index
pour la recherche.</p><p>Si la comparaison est transposée avec une fonction <code>COALESCE</code> et en conservant
la comparaison avec la chaîne vide, il ne sera pas possible d&rsquo;utiliser un index
pour la recherche.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>EXPLAIN</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> emp2 <span style=color:#66d9ef>WHERE</span> ename <span style=color:#66d9ef>IS</span> <span style=color:#66d9ef>NULL</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>--                                QUERY PLAN                                
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- -------------------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>--  Index Scan using emp2_ename on emp2  (cost=0.00..12.87 rows=1 width=20)
</span></span></span><span style=display:flex><span><span style=color:#75715e>--    Index Cond: (ename IS NULL)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>EXPLAIN</span> <span style=color:#66d9ef>SELECT</span> <span style=color:#f92672>*</span> <span style=color:#66d9ef>FROM</span> emp2 <span style=color:#66d9ef>WHERE</span> COALESCE(ename) <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>--                          QUERY PLAN                          
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- -------------------------------------------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>--  Seq Scan on emp2  (cost=0.00..79144.81 rows=20972 width=20)
</span></span></span><span style=display:flex><span><span style=color:#75715e>--    Filter: ((COALESCE(ename))::text = `::text)
</span></span></span></code></pre></div><h4 id=concaténation>Concaténation
<a class=anchor href=#concat%c3%a9nation>#</a></h4><p>Du fait de la spécificité du type <code>VARCHAR2</code> d&rsquo;Oracle, la concaténation d&rsquo;une
valeur NULL dans une chaîne de caractères ne pose pas de problèmes. Elle en pose
cependant dans PostgreSQL. Le standard SQL définit en effet que pour la plupart
des fonctions, un paramètre NULL entraîne un résultat NULL (on parle de fonctions
<code>STRICT</code> dans PostgreSQL). Dans le cas présent, une valeur NULL dans une
opération de concaténation sera propagée au résultat : le résultat sera une
chaîne <code>NULL</code> et non la chaîne de caractères attendue.</p><p>On prendra donc garde à ajouter la fonction <code>COALESCE</code> dans les portions de
code touchées par ce problème :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#e6db74>&#39;nom employé: &#39;</span> <span style=color:#f92672>||</span> COALESCE(ename, <span style=color:#f92672>`</span>) <span style=color:#66d9ef>FROM</span> emp;
</span></span></code></pre></div><h3 id=manipulation-de-dates>Manipulation de dates
<a class=anchor href=#manipulation-de-dates>#</a></h3><h4 id=format-de-sortie>Format de sortie
<a class=anchor href=#format-de-sortie>#</a></h4><p>Pour Oracle, le format défini par <code>NLS_DATE_FORMAT</code> détermine le format des
dates qui sera utilisé pour la sortie des fonctions <code>TO_CHAR()</code> et <code>TO_DATE()</code>.</p><p>Concernant PostgreSQL, par défaut, le format de sortie d&rsquo;une date est conforme
au standard SQL: <code>YYYY-MM-DD HH24:MI:SS.mmmmmmm+TZ</code>. Il est cependant possible
de le modifier avec la variable de configuration <code>DateStyle</code> (par défaut <code>ISO, DMY</code>).</p><h4 id=opérations-sur-les-dates>Opérations sur les dates
<a class=anchor href=#op%c3%a9rations-sur-les-dates>#</a></h4><p>Oracle autorise l&rsquo;ajout ou la soustraction d&rsquo;un nombre entier à une date.
Par exemple :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> SYSDATE <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>FROM</span> DUAL;
</span></span></code></pre></div><p>retournera la date de demain. Pour le type date de PostgreSQL, le comportement
est identique, mais les deux types <code>date</code> ne le sont pas.</p><p>Pour obtenir le même résultat avec un <code>TIMESTAMP</code> (l&rsquo;équivalent du type <code>DATE</code> d&rsquo;Oracle)
sous PostgreSQL, il faut utiliser un <code>INTERVAL</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> now() <span style=color:#f92672>+</span> INTERVAL <span style=color:#e6db74>&#39;1 DAY&#39;</span>;
</span></span></code></pre></div><p>De même, la soustraction d&rsquo;un <code>TIMESTAMP</code> à un autre retourne un nombre
correspondant au nombre de jour entre ces deux dates, alors que, sous PostgreSQL,
cette opération retourne un intervalle.</p><h4 id=portage-de-sysdate>Portage de SYSDATE
<a class=anchor href=#portage-de-sysdate>#</a></h4><p>Attention au type de données <code>DATE</code> sous Oracle, c&rsquo;est en fait du
<code>TIMESTAMP WITHOUT TIMEZONE</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> to_char(sysdate,<span style=color:#e6db74>&#39;DD/MM/YYYY HH24:MI:SS&#39;</span>) <span style=color:#66d9ef>FROM</span> dual;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- TO_CHAR(SYSDATE,&#39;DD
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- -------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- 11/03/2011 14:58:22
</span></span></span></code></pre></div><p>Il convient donc d&rsquo;utiliser <code>LOCALTIMESTAMP</code> (et pas <code>current_timestamp</code>
qui, lui, contient la <em>timezone</em>…) :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>LOCALTIMESTAMP</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>--          timestamp          
</span></span></span><span style=display:flex><span><span style=color:#75715e>-- ----------------------------
</span></span></span><span style=display:flex><span><span style=color:#75715e>--  2011-03-11 16:59:29.889823
</span></span></span></code></pre></div><p>Ainsi, toute variable déclarée en DATE dans du PL/SQL d&rsquo;Oracle doit être
déclarée en TIMESTAMP dans du PL/pgsql de PostgreSQL.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
French</li></ul><ul class=book-languages-list><li><a href=https://example.com/specificities-on-data-types/ class="flex align-center"><img src=/svg/translate.svg class=book-icon alt=Languages>
English</a></li></ul></div><div><a class="flex align-center" href=https://github.com/dalibo/from-oracle-to-postgresql/commit/0e0e39630a9315928b94eb8adbab6b0771fc83ec title='Dernière modification par Florent Jardin | November 21, 2022' target=_blank rel=noopener><img src=/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 21, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/dalibo/from-oracle-to-postgresql/edit/main/content.fr/docs/sql/types.md target=_blank rel=noopener><img src=/svg/edit.svg class=book-icon alt=Edit>
<span>Modifier cette page</span></a></div></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><ul><li><a href=#spécificités-des-types-de-données>Spécificités des types de données</a><ul><li><a href=#manipulation-des-types-varchar>Manipulation des types VARCHAR</a></li><li><a href=#manipulation-de-dates>Manipulation de dates</a></li></ul></li></ul></li></ul></nav></div></aside></main></body></html>