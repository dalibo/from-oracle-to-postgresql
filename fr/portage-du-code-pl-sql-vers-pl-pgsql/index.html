<!doctype html><html lang=fr dir=ltr><head><meta name=generator content="Hugo 0.109.0"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Portage du code PL/SQL vers PL/pgSQL # Principales différences entre PL/SQL et PL/pgSQL # Bien que le SGBD Oracle supporte également la programmation Java côté serveur, et le SGBD PostgreSQL de nombreux langages (PL/Perl, PL/Python, PL/R, etc."><meta name=theme-color content="#FFFFFF"><meta property="og:title" content="Portage du code PL/SQL vers PL/pgSQL"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="https://dalibo.github.io/from-oracle-to-postgresql/fr/portage-du-code-pl-sql-vers-pl-pgsql/"><meta property="og:site_name" content="Porter Oracle vers PostgreSQL"><title>Portage du code PL/SQL vers PL/pgSQL</title><link rel=manifest href=/from-oracle-to-postgresql/manifest.json><link rel=icon href=/from-oracle-to-postgresql/favicon.png type=image/x-icon><link rel=alternate hreflang=en href=https://dalibo.github.io/from-oracle-to-postgresql/pl-sql-to-pl-pgsql-porting/ title="PL/SQL to PL/pgSQL porting"><link rel=stylesheet href=/from-oracle-to-postgresql/book.min.a0b1bf814d7fc28217ec0eea7c47371480fb4f325cec9eb1ae1aa1097d715ec7.css integrity="sha256-oLG/gU1/woIX7A7qfEc3FID7TzJc7J6xrhqhCX1xXsc="><script defer src=/from-oracle-to-postgresql/fr.search.min.e7828a63b0a6f917d99bf7d711c9cbaa10d786e3f83f8aa40da04e3e773dcb9f.js integrity="sha256-54KKY7Cm+RfZm/fXEcnLqhDXhuP4P4qkDaBOPnc9y58="></script>
<script defer src=/from-oracle-to-postgresql/sw.min.83ed3a56e2fac2ed3c3c3e1a69afc266f54bc9e92078450a47292a4db2ee86f1.js integrity="sha256-g+06VuL6wu08PD4aaa/CZvVLyekgeEUKRykqTbLuhvE="></script>
<link rel=alternate type=application/rss+xml href=https://dalibo.github.io/from-oracle-to-postgresql/fr/portage-du-code-pl-sql-vers-pl-pgsql/index.xml title="Porter Oracle vers PostgreSQL"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a href=/from-oracle-to-postgresql/fr><img src=/from-oracle-to-postgresql/images/logo.png alt=Logo><span>Porter Oracle vers PostgreSQL</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Rechercher aria-label=Rechercher maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/differences-generales-entre-oracle-et-postgresql/>Différences générales</a><ul></ul></li><li><input type=checkbox id=section-88c4d5ca464ed2de3d87c4f315803bbb class=toggle>
<label for=section-88c4d5ca464ed2de3d87c4f315803bbb class="flex justify-between"><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/portage-du-schema-de-la-base-de-donnees/>Portage du schéma</a></label><ul><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/correspondance-des-types-de-donnees/>Correspondance des types de données</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/reprise-des-tables/>Reprise des tables</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/reprise-des-vues/>Reprise des vues</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/reprise-des-sequences/>Reprise des séquences</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/reprise-des-index/>Reprise des index</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/reprise-des-partitions/>Reprise des partitions</a></li></ul></li><li><input type=checkbox id=section-b7e37e1862e6db598e5e41747363d74a class=toggle>
<label for=section-b7e37e1862e6db598e5e41747363d74a class="flex justify-between"><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/portage-des-requetes-sql/>Portage des requêtes SQL</a></label><ul><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/specificites-des-types-de-donnees/>Spécificités des types de données</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/jointures/>Jointures</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/expressions-conditionnelles/>Expressions conditionnelles</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/traitement-des-hierarchies/>Traitement des hiérarchies</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/gestion-des-transactions/>Gestion des transactions</a></li></ul></li><li><input type=checkbox id=section-cfaa4d420be7e860c2f111a313f9a252 class=toggle checked>
<label for=section-cfaa4d420be7e860c2f111a313f9a252 class="flex justify-between"><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/portage-du-code-pl-sql-vers-pl-pgsql/ class=active>Portage du code PL/SQL vers PL/pgSQL</a></label><ul><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/portage-des-procedures-et-fonctions/>Portage des procédures et fonctions</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/portage-des-triggers/>Portage des triggers</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/structures-de-controles/>Structures de contrôles</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/reprise-du-code-pl-sql/>Reprise du code PL/SQL</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/curseurs/>Curseurs</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/specificites-pl-sql/>Spécificités PL/SQL</a></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/packages-proprietaires/>Packages propriétaires</a></li></ul></li><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/fr/nous-contacter/>Nous contacter</a><ul></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/from-oracle-to-postgresql/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Portage du code PL/SQL vers PL/pgSQL</strong>
<label for=toc-control><img src=/from-oracle-to-postgresql/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#portage-du-code-plsql-vers-plpgsql>Portage du code PL/SQL vers PL/pgSQL</a><ul><li><a href=#principales-différences-entre-plsql-et-plpgsql>Principales différences entre PL/SQL et PL/pgSQL</a></li><li><a href=#portage-des-packages>Portage des packages</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=portage-du-code-plsql-vers-plpgsql>Portage du code PL/SQL vers PL/pgSQL
<a class=anchor href=#portage-du-code-plsql-vers-plpgsql>#</a></h1><h2 id=principales-différences-entre-plsql-et-plpgsql>Principales différences entre PL/SQL et PL/pgSQL
<a class=anchor href=#principales-diff%c3%a9rences-entre-plsql-et-plpgsql>#</a></h2><p>Bien que le SGBD Oracle supporte également la programmation Java côté serveur,
et le SGBD PostgreSQL de nombreux langages (PL/Perl, PL/Python, PL/R, etc.),
cette partie ne traite que du portage du PL/SQL en code PL/pgSQL.</p><p>Le langage PL/pgSQL de PostgreSQL est conçu à l&rsquo;origine pour être ressemblant au
langage PL/SQL d&rsquo;Oracle. Cependant, ce sont deux langages différents qui nécessitent
un certain travail pour passer de l&rsquo;un à l&rsquo;autre.</p><p>Tout d&rsquo;abord, on note l&rsquo;absence de <em>package</em> dans PostgreSQL. Il est donc
nécessaire d&rsquo;utiliser un moyen de contournement pour émuler leur fonctionnement.</p><p>Principales différences :</p><ul><li>pas de packages ;</li><li>code compilé à la première exécution, pas de façon globale ;</li><li>contrairement aux fonctions, les procédures ne peuvent pas retourner de données ;</li><li>pas de transaction autonome ;</li><li>pas de fonctionnalités comme les directories… PL/PgSQL ne manipule pas de fichiers.</li></ul><p>Pour ce dernier point, les autres langages PL comblent ce manque (et plus). Il
est aussi à noter que le langage d&rsquo;écriture de la fonction est transparent pour
l&rsquo;appelant.</p><h2 id=portage-des-packages>Portage des packages
<a class=anchor href=#portage-des-packages>#</a></h2><p>Un <em>package</em> Oracle, ou paquet de fonctions, est le regroupement logique de
variables et de procédures stockées. Il n&rsquo;existe pas de notion de paquets de
fonctions dans PostgreSQL. Pour simplifier le portage, Ora2Pg va créer un schéma
portant le nom du paquet et importer les fonctions dans ce schéma. Ceci permet
de garder la notation Oracle <code>PACKAGE.PROCEDURE</code> qui sera en fait sous
PostgreSQL <code>SCHEMA.FONCTION</code>.</p><p>Oracle permet également de définir des fonctions à l&rsquo;intérieur d&rsquo;autres fonctions.
PostgreSQL ne le permet pas avec PL/PgSQL. Elles devront être extraites du corps
de leur fonction parente et déclarées comme les autres fonctions.</p><p>La notion de variable globale n&rsquo;existe pas sous PL/PgSQL. Pour pouvoir émuler le
comportement des variables globales, on peut utiliser les variables
utilisateurs, qu&rsquo;il faudra définir dans le fichier de configuration
<code>postgresql.conf</code>, au niveau de la base, de l&rsquo;utilisateur ou de la session.</p><p>Celles-ci doivent être préfixée par un espace de nom au choix, pour ne pas
rentrer en conflit avec les variables systèmes. Une bonne pratique consiste à
préfixer une variable par le nom du schéma qui imite le <em>package</em>. La variable
reste locale à une session et ne persiste pas à sa fermeture ni ne peut se
partager entre plusieurs sessions.</p><p>Par exemple, pour créer une variable globale nommée <code>id_region</code>, il suffit
d&rsquo;utiliser la commande <code>SET</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SET</span> monschema.id_region <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;38&#39;</span>;
</span></span></code></pre></div><p>et pour utiliser sa valeur dans la même session :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#66d9ef>SELECT</span> current_setting(<span style=color:#e6db74>&#39;monschema.id_region&#39;</span>) <span style=color:#66d9ef>AS</span> id_region;
</span></span></code></pre></div><p>Il est également possible d&rsquo;utiliser la fonction <code>set_config</code> à l&rsquo;intérieur
d&rsquo;une fonction PL/pgSQL. Le troisième paramètre de la méthode permet de
déterminer si la variable est locale à la transaction ou globale dans la
session.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>PERFORM set_config(<span style=color:#e6db74>&#39;monschema.id_region&#39;</span>, <span style=color:#e6db74>&#39;38&#39;</span>, <span style=color:#66d9ef>false</span>);
</span></span></code></pre></div><p>Dans un bloc PL/pgSQL, la méthode <code>current_setting</code> peut être directement
employée pour assignée la valeur dans une variable ou à travers le mot-clé
<code>INTO</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>a :<span style=color:#f92672>=</span> current_setting(<span style=color:#e6db74>&#39;monschema.id_region&#39;</span>);
</span></span></code></pre></div><p>Il est également possible d&rsquo;utiliser une table pour définir ces variables et
leurs valeurs. Par ailleurs, certains langages PL, comme PL/Perl par exemple,
disposent quant à eux, de variables globales.</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div class=book-languages tabindex=0 aria-haspopup=true><ul><li class="flex align-center"><img src=/from-oracle-to-postgresql/svg/translate.svg class=book-icon alt=Languages>
French</li></ul><ul class=book-languages-list><li><a href=https://dalibo.github.io/from-oracle-to-postgresql/pl-sql-to-pl-pgsql-porting/ class="flex align-center"><img src=/from-oracle-to-postgresql/svg/translate.svg class=book-icon alt=Languages>
English</a></li></ul></div><div><a class="flex align-center" href=https://github.com/dalibo/from-oracle-to-postgresql/commit/0e0e39630a9315928b94eb8adbab6b0771fc83ec title='Dernière modification par Florent Jardin | November 21, 2022' target=_blank rel=noopener><img src=/from-oracle-to-postgresql/svg/calendar.svg class=book-icon alt=Calendar>
<span>November 21, 2022</span></a></div><div><a class="flex align-center" href=https://github.com/dalibo/from-oracle-to-postgresql/edit/main/content.fr/docs/plsql/_index.md target=_blank rel=noopener><img src=/from-oracle-to-postgresql/svg/edit.svg class=book-icon alt=Edit>
<span>Modifier cette page</span></a></div></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#portage-du-code-plsql-vers-plpgsql>Portage du code PL/SQL vers PL/pgSQL</a><ul><li><a href=#principales-différences-entre-plsql-et-plpgsql>Principales différences entre PL/SQL et PL/pgSQL</a></li><li><a href=#portage-des-packages>Portage des packages</a></li></ul></li></ul></nav></div></aside></main></body></html>